# PgSQL_research
Исследование данных с сайта hh.ru , а именно -  резюме соискателей.


На этой странице:

1. [знакомство с датасетом](#dataset);
2. [предварительный анализ данных](#first-view);
3. [глобальный анализ показателей](#global-view).
4. [анализ кандидатов](#candidates);
5. [общий вывод](#outcome).

## <a id="dataset"></a>Знакомство с датасетом
Нормализованные  данные HeadHunter, размещенные в БД SQL

### ER-диаграмма
![dst3-u2-pr2_1_1](https://user-images.githubusercontent.com/84207955/153757480-1d1ffc88-cb8f-40ad-ade8-d826d5e28162.png)

## <a id="first-view"></a>Предварительный анализ данных

### Задание 2.1
Рассчитайте максимальный возраст (max_age) кандидата в таблице.

```sql
select
    max(age) max_age
from
    hh.candidate
```

![](./images/2.1.png)
### *Вывод*
Вывод: Вероятность того,что человек в возрасте 100 лет будет заинтересован в работе -крайне мала, поэтому,с высокой долей вероятности,это значение является выбросом.
### Задание 2.2

Теперь давайте рассчитаем минимальный возраст (min_age) кандидата в таблице.

```sql
select
    min(age) max_age
from
    hh.candidate
```

![](./images/2.2.png)
### *Вывод*
Вывод: Минимальный возраст кандидата -14 лет, скорее всего это значимый показатель.

### Задание 2.3

Напишите запрос, который позволит посчитать, сколько (cnt) человек какого возраста (age) у нас есть.

Отсортируйте результат по возрасту в обратном порядке.

```sql
select 
    age,
    count(*) cnt
from 
    hh.candidate
group by 
    -- группируем кандидатов по возрасту
    -- чтобы применить агрегирующую функцию
    age
order by 
    age desc
```

![](./images/2.3.png)
### *Вывод*
Вывод: Большинство соискателей находятся в возрасте от 25 до 45, пик приходится на 30 лет.  Несовершеннолетних всего лишь 21 человек, от 72 до 100 -10 человек.  Если проследить линию возраста от 72 и старше,то видно полное отсутствие кандидатов в возрасте от 78 до 99 , что позволяет убедиться в том,что 100-летний кандидат является выбросом. Рассмотрим противоположную сторону -  подростки от 14 до 18 лет представляют собой непрерывное “множество”,т.е. значения есть и в 14,и в 15,и в 16-17 лет, соответственно нельзя считать 14 -летнего кандидата выбросом, значение принадлежит кривой нормального распределения.

### Задание 2.4

По данным Росстата, средний возраст занятых в экономике России составляет 39.7 лет. Мы округлим это значение до 40.

Найдите количество кандидатов, которые старше данного возраста. Не забудьте отфильтровать «ошибочный» возраст 100.

```sql
select 
    count(*)
from 
    hh.candidate
where
    age between 41 and 99 
    -- Mожно было использовать два условия:
    -- `age > 40 and age < 100`
    -- Но мне кажется `between` легче считывается.
    -- (По производительности они одинаковы.)
```

![](./images/2.4.png)

### *Вывод*
Вывод: Всего в таблице candidate 44744 кандидата, если учесть этот факт, то можно сказать,что примерно 13% кандидатов старше 40 лет. Такое значение кажется заниженным, или можно объяснить это тем,что люди после 40 лет менее склонны к смене места работы , возможно в этому возрасту люди достигают определенного статуса на своем месте работы и не стремятся его покинуть. 

## <a id="global-view"></a>Глобальный анализ показателей
### Задание 3.1

Напишите запрос, который позволит узнать, сколько (cnt) у нас кандидатов из каждого города (city).

Отсортируйте результат по количеству в обратном порядке.

```sql
select 
    c.title city,
    count(*) cnt
from 
    hh.candidate cnd
left join
    -- присоединяем таблицу-справочник `city`
    -- по `city_id` кандидата
    hh.city c on c.id = cnd.city_id
group by 
    -- группируем кандидатов по городам
    -- чтобы применить `count`
    c.title
order by 
    cnt desc
```

![](./images/3.1.png)
### *Вывод*
Вывод:  Самое большое количество кандидатов сконцентрированы в г.Москва, но смущает тот факт, что в г. Санкт-Петербург кандидатов разительно меньше. Возможно многие кандидаты ищут работу в удаленном формате и поэтому указывают место работы г.Москва , как возможность найти самый высокооплачиваемый оффер. Также возможно ,что низкоквалифицированных работников ,переезжающих из  других стран и регионов , привлекают зарплаты в Москве,поэтому концентрация таких кандидатов  приводит к  такому отрыву Москвы от Санкт-Петербурга. 
На третьем месте находится Краснодар ( почему-то не Екатеринбург).Наши люди любят перемещаться  к югу,вероятно много  иногородних,которые находятся в поиске работы.
### Задание 3.2

Напишите запрос, который позволит понять, каких кандидатов из Москвы устроит «проектная работа».

Формат выборки: gender, age, desirable_occupation, city, employment_type.

Отсортируйте результат по id кандидата.

```sql
select
    cnd.gender,
    cnd.age,
    cnd.desirable_occupation,
    c.title city,
    cnd.employment_type
from
    hh.candidate cnd
left join
    -- присоединяем таблицу-справочник `city`
    hh.city c on c.id = cnd.city_id
where
    -- выбираем записи московских кандидатов
    c.title = 'Москва'
    -- с текстом "проектная работа" 
    -- в колонке `employment_type`
    -- (содержимое этой колонки преобразуем
    -- к нижнему регистру, на всякий случай)
    and lower(cnd.employment_type) like '%проектная работа%'
order by
    cnd.id
```

![](./images/3.2.png)

### *Вывод*
Вывод: На проектную работу чаще всего претендуют IT-специалисты, что выглядит логичным. Скорее всего , помимо проектной работы  это еще и удаленный формат
### Задание 3.3

Данных оказалось многовато. Отфильтруйте только самые популярные IT-профессии — разработчик, аналитик, программист.

Обратите внимание, что данные названия могут быть написаны как с большой, так и с маленькой буквы.

Отсортируйте результат по городу и id кандидата.

```sql
select 
    cnd.gender,
    cnd.age,
    cnd.desirable_occupation,
    c.title city,
    cnd.employment_type
from
    hh.candidate cnd
left join 
    hh.city c on c.id = cnd.city_id
where
    -- по-прежнему ищем в Москве
    c.title = 'Москва'
    -- кандидатов согласных на проектную работу
    and lower(cnd.employment_type) like '%проектная работа%'
    -- добавляем еще одно условие: желаемая профессия это 
    -- разработчик, аналитик или программист
    -- (переводим `desirable_occupation` в нижний регистр)
    and (
        lower(desirable_occupation) like '%разработчик%'
        or lower(desirable_occupation) like '%аналитик%'
        or lower(desirable_occupation) like '%программист%'
    )
order by
    c.title, cnd.id
```

![](./images/3.3.png)
Вывод:
Бегло просмотрев записи бросилось в глаза,что мужчин больше,чем женщин. Чаще в возрасте от 23 до 40 лет, однако много и тех,кто приходит в IT в 63 , что выглядит оптимистично и вселяет радость за них.
### Задание 3.4

Для общей информации попробуйте выбрать номера и города кандидатов, у которых занимаемая должность совпадает с желаемой.

Формат выборки: id, city.

Отсортируйте результат по городу и id кандидата.

```sql
select
    cnd.id,
    c.title city
from
    hh.candidate cnd
left join
    -- присоденияем город
    hh.city c on c.id = cnd.city_id
where
    -- условие: занимаемая и желаемая должность должны совпадать
    cnd.desirable_occupation = cnd.current_occupation
order by 
    c.title, cnd.id
```

![](./images/3.4.png)

### *Вывод*
Вывод: Счастливые люди есть во всех городах, однако есть причины,по которым они ищут другую работу, вероятно не устраивают условия труда или оплата. ID кандидата позволит нам вычислить личности,но никак не поможет в построении выводов о количестве людей в конкретных городах. Для этого нужно строить другой запрос.
### Задание 3.5

Определите количество кандидатов пенсионного возраста.

Пенсионный возраст для мужчин наступает в 65 лет, для женщин — в 60 лет.

```sql
-- отфильтровываем кандидатов, указавших возраст 100 лет
with filtered_cnd as (
    select
        *
    from
        hh.candidate
    where
        age < 100
)

select
    count(*)
from
    filtered_cnd
where
    -- выбираем мужчин 65+
    (gender = 'M' and age >= 65)
    -- или женщин 60+
    or (gender = 'F' and age >= 60)
```

![](./images/3.5.png)

### *Вывод*
Вывод: кандидатов пенсионного возраста всего лишь 75 человек!!Мне кажется это очень странным,хотя бы потому,что прожить на пенсию очень сложно, и ,по всей логике, из  44744 тыс. человек пенсионеров могло бы быть и больше. Вероятно многие пенсионеры не способны работать по состоянию здоровья, а также многие люди старшего поколения плохо ориентируются в интернет-пространстве и просто не выкладывают свои резюме на HH. Причина такого низкого количества требует отдельного расследования.
## <a id="candidates"></a>Анализ кандидатов для заказчиков
### Задание 4.1

Для добывающей компании нам необходимо подобрать кандидатов из Новосибирска, Омска, Томска и Тюмени, которые готовы работать вахтовым методом.

Формат выборки: gender, age, desirable_occupation, city, employment_type, timetable_type.

Отсортируйте результат по городу и номеру кандидата.

```sql
select 
    cnd.gender,
    cnd.age,
    cnd.desirable_occupation,
    c.title city,
    cnd.employment_type,
    tt.title timetable_type
from
    hh.candidate cnd
left join
    -- присоединяем город по ключу
    hh.city c on c.id = cnd.city_id
inner join
    -- присоединяем таблицу-связку
    hh.candidate_timetable_type ctt on ctt.candidate_id = cnd.id
inner join
    -- присоединяем таблицу вариантов рабочего графика
    hh.timetable_type tt on tt.id = ctt.timetable_id
where
    -- задаем первое условие: один из четырех городов
    c.title in ('Новосибирск', 'Омск', 'Томск', 'Тюмень')
    -- задаем второе условие: рабочий график - вахтовый метод
    and tt.title = 'вахтовый метод'
order by
    c.title, cnd.id
```

![](./images/4.1.png)

### *Вывод*
Выборка готова,останется только сохранить в csv и отдать работодателю.
*Cоискателй согласных работать вахтовым методом довольно мало, меньше 1% от общего числа. Полагаю, добывающая компания, для которой мы искали эту ифнормацию, знает о дефиците вахтовиков на рынке труда, ведь она даже не указала интересующие ее профессии.*
### Задание 4.2

Для заказчиков из Санкт-Петербурга нам необходимо собрать список из 10 желаемых профессий кандидатов из того же города от 16 до 21 года (в выборку включается 16 и 21, сортировка производится по возрасту) с указанием их возраста, а также добавить строку Total с общим количеством таких кандидатов.

```sql
-- выбираем желаемую профессию и возраст
with spb_yng_ocp as (
    select 
        cnd.desirable_occupation, 
        cnd.age
    from 
        hh.candidate cnd
    left join 
        hh.city c on c.id = cnd.city_id
    where 
        -- у кандидатов из СПб.
        c.title = 'Санкт-Петербург'
        -- в возрасте от 16 до 21 включительно
        and cnd.age between 16 and 21
)

(select *
from spb_yng_ocp
-- сортируем по возрасту
order by age
-- берем первые 10 строк
limit 10)

UNION ALL

-- добавляем нижний колонтитул
select 'Total', count(*) 
from spb_yng_ocp
```

![](./images/4.2.png)

### *Вывод*
Вывод: Отрадно видеть, что молодежь в Санкт-Петербурге претендует на высокооплачиваемые должности, требующие широкого кругозора и  гибкого ума ( ожидала увидеть сотрудников KFC :) )
## <a id="outcome"></a>Общий вывод

Мы познакомились с БД HeadHunter и узнали, что в ней находится информация о 44743 соискателях из 984 городов. Самому младшему из них 14 лет, самому старшему — 77 (один кандидат, указавший возраст 100 лет, был исключен из результатов). Наибольшая возрастнастная страта — 30 лет, людей пенсионного возраста - 75 человек. Мужчин в базе значительно больше, чем женщин - 81%. Самый большой рынок труда находится в Москве. Молодежь крупных городов интересуют профессии в IT-сфере, а в городах Сибири очень мало желающих работать вахтовиками. Каждый девятый соискатель хочет сменить место работы, не меняя профессии. Информация была собрана в период с апреля 2018 года по май 2019.

Вот еще на какие вопросы можно было бы поискать ответы:
- Больше ли молодых соискателей в крупных городах?
- Каково распределение ожидаемой ЗП по городам/возрастным категориям?
- Какие специалисты являются самыми дорогими?
- Какого рода специалисты (и из каких городов) готовы к удаленной работе?
- Есть ли разница в ожидаемой ЗП у одинаковых специалистов, работающих полный рабочий день и удаленно?
- Есть ли разница в ожидаемой ЗП у одинаковых специалистов мужчин и женщин?
